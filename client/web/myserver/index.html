<!DOCTYPE html>

<html class="no-js">
<head>
    <title>HotCit</title>
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/main.css">
    <script src="js/jquery-2.0.3.js"></script>
    <script src="js/underscore-1.1.6.js"></script>
    <script src="js/backbone.js"></script>
    <link href="bootstrap/css/bootstrap.css" rel="stylesheet">
    <script src="js/ServerDao.js"></script>
    <script>
    $(document).ready(function() {
        function getr(prefix) { return prefix+Math.floor(Math.random()*9999); }
        function print() { console.log(arguments) }
        function printBody() { console.log("body: ", arguments[0]) }
        function printOptions(body) { console.log(arguments[0][0]); }
        
        
        function dummy() {  }
        var error = print;
        var success = dummy;
        
        var players = [ "ada", "turing", "hopper", "wiener" ],
            gameid = getr("game");
            
        // simple_gameplay_v2.test
        // LOPPY SETUP
        lobbyAPI.create_game(gameid, players[0], 3, 5, success, error);
        lobbyAPI.joinGame(gameid, players[1], success, error);
        lobbyAPI.joinGame(gameid, players[2], success, error);
        lobbyAPI.leaveGame(gameid, players[1], success, error);
        lobbyAPI.flagReady(gameid, players[0], success, error);
        lobbyAPI.joinGame(gameid, players[3], success, error);
        lobbyAPI.flagReady(gameid, players[3], success, error);
        lobbyAPI.cancelReady(gameid, players[0], success, error);
        lobbyAPI.flagReady(gameid, players[2], success, error);
        lobbyAPI.flagReady(gameid, players[0], success, error);
        
        // GAME ACTIONS
        // SELECT PLAYERS
        gameAPI.getOptions(gameid, players[0], printOptions, error);
        gameAPI.doSelect(gameid, players[0], 'magician', success, error);
        gameAPI.doSelect(gameid, players[2], 'king', success, error);
        gameAPI.doSelect(gameid, players[3], 'thief', success, error);
        gameAPI.doSelect(gameid, players[0], 'warlord', success, error);
        gameAPI.doSelect(gameid, players[2], 'assassin', success, error);
        gameAPI.doSelect(gameid, players[3], 'merchant', success, error);
        // TODO: include an explicit end turn statement?
        
        // FIRST TURN
        // why send source?
        gameAPI.doAbility(gameid, players[2], "assassin", "merchant", success, error);
        gameAPI.doTakeGold(gameid, players[2], success, error);
        gameAPI.getOptions(gameid, players[2], printOptions, error);
        gameAPI.doEndTurn(gameid, players[2], success, error);
        gameAPI.getOptions(gameid, players[0], printOptions, error);
    });
    </script>
    <style></style>

</head>
<body>
    <h1>TODO</h1>
    <p>refactor to use futures</p>
</body>
</html>
