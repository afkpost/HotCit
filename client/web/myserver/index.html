<!DOCTYPE html>

<html class="no-js">
<head>
    <title>HotCit</title>
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/main.css">
    <script src="js/jquery-2.0.3.js"></script>
    <script src="js/underscore-1.1.6.js"></script>
    <script src="js/backbone.js"></script>
    <link href="bootstrap/css/bootstrap.css" rel="stylesheet">
    <script src="js/ServerDao.js"></script>
    <script>
    $(document).ready(function() {
        function getr(prefix) { return prefix+Math.floor(Math.random()*9999); }
        function print() { console.log(arguments) }
        function printBody() { console.log("body: ", arguments[0]) }
        function printOptions(body, playerid) { console.log("options: " + playerid + ":", arguments[0]); }
        
        
        function dummy() {  }
        var error = function(gameid, playerid) {
            return function() {
                gameAPI.getOptions(gameid, playerid, printOptions, error);
                console.error(arguments);
            }
        };
        var success = dummy;
        
        var players = [ "ada", "turing", "hopper", "wiener" ],
            gameid = getr("game");
            
        // simple_gameplay_v2.test
        // LOPPY SETUP
        lobbyAPI.create_game(gameid, players[0], 3, 5, success, error);
        lobbyAPI.joinGame(gameid, players[1], success, error(gameid, players[1]));
        lobbyAPI.joinGame(gameid, players[2], success, error(gameid, players[2]));
        lobbyAPI.leaveGame(gameid, players[1], success, error(gameid, players[1]));
        lobbyAPI.flagReady(gameid, players[0], success, error(gameid, players[0]));
        lobbyAPI.joinGame(gameid, players[3], success, error(gameid, players[3]));
        lobbyAPI.flagReady(gameid, players[3], success, error(gameid, players[3]));
        lobbyAPI.cancelReady(gameid, players[0], success, error(gameid, players[0]));
        lobbyAPI.flagReady(gameid, players[2], success, error(gameid, players[2]));
        lobbyAPI.flagReady(gameid, players[0], success, error(gameid, players[0]));
        
        // GAME ACTIONS
        // SELECT PLAYERS
        gameAPI.doSelect(gameid, players[0], 'magician', success, error(gameid, players[0]));
        gameAPI.doSelect(gameid, players[2], 'king', success, error(gameid, players[2]));
        gameAPI.doSelect(gameid, players[3], 'thief', success, error(gameid, players[3]));
        gameAPI.doSelect(gameid, players[0], 'warlord', success, error(gameid, players[0]));
        gameAPI.doSelect(gameid, players[2], 'assassin', success, error(gameid, players[2]));
        gameAPI.doSelect(gameid, players[3], 'merchant', success, error(gameid, players[3]));
        // TODO: include an explicit end turn statement?
        
        // FIRST TURN
        // why send source, seems unneccessary, maybe nice for debuging?
        gameAPI.getOptions(gameid, players[2], printOptions, error(gameid, players[2]));

        // should be allowed! (and required action to do first)
        // gameAPI.doAbility(gameid, players[2], "assassin", "merchant", success, error(gameid, players[2]));
        
        gameAPI.doTakeGold(gameid, players[2], success, error(gameid, players[2]));
        
        // nobody has any cards in their hands!
        gameAPI.doBuild(gameid, players[2], "castle", success, error(gameid, players[2]));
        gameAPI.doEndTurn(gameid, players[2], success, error(gameid, players[2]));
        gameAPI.getOptions(gameid, players[2], printOptions, error(gameid, players[2]));

    });
    </script>
    <style></style>

</head>
<body>
    <h1>TODO</h1>
    <p>refactor to use futures</p>
</body>
</html>
